machine:
    services:
        - docker

dependencies:
    override:
        - docker info
        - docker build -t zpalchick/flask-docker-workflow .

test:
    override:
        - docker run -d -p 80:80 zpalchick/flask-docker-workflow; sleep 10
        - curl --retry 10 --retry-delay 5 -v http://localhost:80
        - pip3 install -r requirements.txt
        - python3 app/tests.py

deployment:
    hub:
        branch: master
        commands:
            - $DEPLOY
